<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết sản phẩm - Flower Shop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/detail.css">
    <link rel="stylesheet" th:href="@{/css/home.css}">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <a href="/home">
                <h1>FIAMA</h1>
            </a>
        </div>
        <nav class="nav-links">
            <a href="/home">Trang chủ</a>
            <a href="/product">Sản phẩm</a>
            <a href="#">Liên hệ</a>
        </nav>
        <div class="utility-nav">
            <div th:if="${isLoggedIn}" class="user-dropdown">
                <a href="#" class="user-link">
                    <i class="fas fa-user"></i>
                    <span th:text="${userDisplayName}">User</span>
                </a>
                <div class="dropdown-menu">
                    <a href="/account">Tài khoản</a>
                    <a href="/logout">Đăng xuất</a>
                </div>
            </div>
            <a th:if="${!isLoggedIn}" href="/login" class="user-link">
                <i class="fas fa-user"></i>
                <span>Đăng nhập</span>
            </a>
            <a href="/cart" class="cart-icon-wrapper">
                <i class="fas fa-shopping-bag"></i>
                <span class="cart-count">0</span>
            </a>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <div class="container">
            <a href="/home">Trang chủ</a>
            <span class="separator">›</span>
            <a href="/product">Sản phẩm</a>
            <span class="separator">›</span>
            <span class="current">Chi tiết sản phẩm</span>
        </div>
    </div>

    <!-- Product Detail Section -->
    <section class="product-detail-section">
        <div class="container">
            <div class="product-detail-grid">
                <!-- Product Images -->
                <div class="product-images" th:if="${product != null}">
                    <div class="main-image">
                        <img id="mainProductImage" th:src="${product.imageUrl}" th:alt="${product.name}" alt="Product">
                    </div>
                    <div class="thumbnail-images">
                        <img th:src="${product.imageUrl}" alt="Thumbnail 1" class="thumbnail active" data-index="0">
                        <img th:src="${product.imageUrl}" alt="Thumbnail 2" class="thumbnail" data-index="1">
                        <img th:src="${product.imageUrl}" alt="Thumbnail 3" class="thumbnail" data-index="2">
                        <img th:src="${product.imageUrl}" alt="Thumbnail 4" class="thumbnail" data-index="3">
                    </div>
                </div>

                <!-- Product Info -->
                <div class="product-info-detail" th:if="${product != null}" 
                     th:attr="data-product-id=${product.id}, data-product-name=${product.name}, data-product-price=${product.price}, data-product-image=${product.imageUrl}, data-product-stock=${product.stockQuantity}">
                    <h1 class="product-title" id="productTitle" th:text="${product.name}">Cây Hoa Hồng Hồng</h1>
                    
                    <div class="price-rating-row">
                        <div class="product-price-wrapper">
                            <span class="product-price" id="productPrice" th:text="'₫' + ${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')}">₫420,000</span>
                        </div>
                        <div class="product-rating">
                            <div class="rating-stars">
                                <th:block th:each="i : ${#numbers.sequence(1, 5)}">
                                    <i th:if="${product.isStarFilled(i)}" class="fas fa-star filled"></i>
                                    <i th:if="${product.isStarHalfFilled(i)}" class="fas fa-star-half-alt"></i>
                                    <i th:if="${product.isStarEmpty(i)}" class="far fa-star"></i>
                                </th:block>
                            </div>
                            <span class="rating-count" th:text="'(' + ${product.getReviewCount()} + ' đánh giá)'">(0 đánh giá)</span>
                        </div>
                    </div>

                    <div class="product-short-description" th:if="${product != null}">
                        <p id="productShortDesc" th:if="${product.description != null && !#strings.isEmpty(product.description)}" th:text="${product.description}">Hoa tươi cao cấp được chọn lọc kỹ lưỡng từ vườn ươm uy tín.</p>
                        <p id="productShortDesc" th:if="${product.description == null || #strings.isEmpty(product.description)}">Hoa tươi cao cấp được chọn lọc kỹ lưỡng từ vườn ươm uy tín. Mỗi bông hoa đều được chăm sóc cẩn thận để đảm bảo độ tươi và vẻ đẹp hoàn hảo.</p>
                    </div>

                    <div class="product-meta">
                        <div class="meta-item" th:if="${product.category != null}">
                            <span class="meta-label">Danh mục:</span>
                            <span class="meta-value" th:text="${product.category}">Hoa hồng</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Tình trạng:</span>
                            <span class="meta-value stock-status" id="stockStatus" 
                                  th:if="${product.stockQuantity > 0}" 
                                  th:text="'Còn hàng (' + ${product.stockQuantity} + ' sản phẩm)'" 
                                  style="color: #4caf50;">Còn hàng</span>
                            <span class="meta-value stock-status" id="stockStatus" 
                                  th:if="${product.stockQuantity == 0 || product.stockQuantity == null}" 
                                  th:text="'Hết hàng'" 
                                  style="color: #f44336;">Hết hàng</span>
                        </div>
                    </div>

                    <div class="quantity-cart-row">
                        <div class="quantity-section">
                            <label class="quantity-label">Số lượng:</label>
                            <div class="quantity-selector-detail">
                                <button class="qty-btn-detail minus-btn-detail">-</button>
                                <input type="number" id="productQuantity" value="1" min="1" th:max="${product.stockQuantity}" class="qty-input-detail">
                                <button class="qty-btn-detail plus-btn-detail">+</button>
                            </div>
                        </div>
                        <button class="add-to-cart-btn-detail" id="addToCartBtn" th:disabled="${product.stockQuantity == 0 || product.stockQuantity == null}">
                            <i class="fas fa-shopping-cart"></i>
                            Thêm vào giỏ hàng
                        </button>
                    </div>
                </div>
            </div>

            <!-- Product Tabs -->
            <div class="product-tabs">
                <div class="tab-buttons">
                    <button class="tab-button active" data-tab="description">Mô tả</button>
                    <button class="tab-button" data-tab="reviews">Đánh giá</button>
                </div>

                <div class="tab-contents">
                    <div class="tab-content-detail active" id="description" th:if="${product != null}">
                        <h3>Mô tả sản phẩm</h3>
                        <div id="productFullDescription" style="white-space: pre-line;">
                            <div th:if="${product.description != null && !#strings.isEmpty(product.description)}">
                                <p th:text="${product.description}">Hoa tươi cao cấp được chọn lọc kỹ lưỡng từ vườn ươm uy tín.</p>
                            </div>
                            <div th:if="${product.description == null || #strings.isEmpty(product.description)}">
                                <p>Hoa tươi cao cấp được chọn lọc kỹ lưỡng từ vườn ươm uy tín. Mỗi bông hoa đều được chăm sóc cẩn thận để đảm bảo độ tươi và vẻ đẹp hoàn hảo. Thích hợp trang trí nhà cửa, văn phòng hoặc làm quà tặng ý nghĩa cho người thân yêu.</p>
                                <p>Sản phẩm được đóng gói cẩn thận, giao hàng nhanh chóng trong vòng 2-3 giờ tại khu vực nội thành.</p>
                                <ul>
                                    <li>Hoa tươi 100%, nhập khẩu trực tiếp</li>
                                    <li>Bảo quản được 7-10 ngày</li>
                                    <li>Miễn phí thiệp chúc mừng</li>
                                    <li>Đổi trả trong 24h nếu không hài lòng</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content-detail" id="reviews">
                        <h3>Đánh giá từ khách hàng</h3>
                        <div class="reviews-summary" th:if="${product != null}">
                            <div class="average-rating">
                                <div class="rating-number" th:text="${#numbers.formatDecimal(product.getAverageRating(), 1, 'POINT', 1, 'POINT')}">5.0</div>
                                <div class="rating-stars-large">
                                    <th:block th:each="i : ${#numbers.sequence(1, 5)}">
                                        <i th:if="${product.isStarFilled(i)}" class="fas fa-star filled"></i>
                                        <i th:if="${product.isStarHalfFilled(i)}" class="fas fa-star-half-alt"></i>
                                        <i th:if="${product.isStarEmpty(i)}" class="far fa-star"></i>
                                    </th:block>
                                </div>
                                <div class="rating-count-text" th:text="'Dựa trên ' + ${product.getReviewCount()} + ' đánh giá'">Dựa trên 0 đánh giá</div>
                            </div>
                        </div>

                        <div class="reviews-list">
                            <div th:if="${reviews == null || reviews.isEmpty()}" class="no-reviews">
                                <p>Chưa có đánh giá nào cho sản phẩm này.</p>
                            </div>
                            <div th:each="review : ${reviews}" class="review-item">
                                <div class="reviewer-info">
                                    <div class="reviewer-avatar" th:text="${review.account.fullName != null ? review.account.fullName.charAt(0).toUpperCase() : (review.account.username != null ? review.account.username.charAt(0).toUpperCase() : 'U')}">N</div>
                                    <div class="reviewer-details">
                                        <h4 class="reviewer-name" th:text="${review.account.fullName != null ? review.account.fullName : review.account.username}">Nguyễn Văn A</h4>
                                        <div class="review-stars">
                                            <th:block th:each="i : ${#numbers.sequence(1, 5)}">
                                                <i th:if="${review.rating >= i}" class="fas fa-star"></i>
                                                <i th:if="${review.rating < i}" class="far fa-star"></i>
                                            </th:block>
                                        </div>
                                    </div>
                                </div>
                                <p class="review-text" th:text="${review.comment != null ? review.comment : ''}">Hoa rất đẹp và tươi, giao hàng nhanh. Rất hài lòng!</p>
                                <span class="review-date" th:text="${review.reviewDate != null ? #temporals.format(review.reviewDate, 'dd/MM/yyyy') : ''}">15/11/2024</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span>Đã thêm vào giỏ!</span>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <!-- Column 1: Opening Time -->
            <div class="footer-column">
                <h4>Giờ mở cửa</h4>
                <div class="footer-opening-time">
                    <div class="opening-time-row">
                        <span class="opening-day">Thứ 2 - Thứ 6:</span>
                        <span class="opening-hours">8:00 - 22:00</span>
                    </div>
                    <div class="opening-time-row">
                        <span class="opening-day">Thứ 7:</span>
                        <span class="opening-hours">9:00 - 20:00</span>
                    </div>
                    <div class="opening-time-row">
                        <span class="opening-day">Chủ nhật:</span>
                        <span class="opening-hours">14:00 - 18:00</span>
                    </div>
                    <p class="footer-holiday">Chúng tôi làm việc cả ngày lễ</p>
                </div>
            </div>
            
            <!-- Column 2: Contact -->
            <div class="footer-column">
                <h4>Liên hệ</h4>
                <div class="footer-contact-info">
                    <p><i class="fas fa-map-marker-alt"></i> Thành phố Hồ Chí Minh, Việt Nam</p>
                    <p><i class="fas fa-phone"></i> +84 123 456 789</p>
                    <p><i class="fas fa-envelope"></i> info@fiama.com</p>
                </div>
            </div>
            
            <!-- Column 3: Central Section with Logo, Social, Apps -->
            <div class="footer-column footer-center-column">
                <div class="footer-logo-center">FIAMA</div>
                <div class="footer-social-icons">
                    <a href="#" class="social-icon" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-icon" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-icon" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-icon" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                </div>
                <div class="footer-app-buttons">
                    <a href="#" class="app-button app-store">
                        <i class="fab fa-apple"></i>
                        <span>Tải từ APP STORE</span>
                    </a>
                    <a href="#" class="app-button google-play">
                        <i class="fab fa-google-play"></i>
                        <span>Tải từ GOOGLE PLAY</span>
                    </a>
                </div>
            </div>
            
            <!-- Column 4: My Account -->
            <div class="footer-column">
                <h4>Tài khoản của tôi</h4>
                <ul>
                    <li><a href="/account">Tài khoản của tôi</a></li>
                    <li><a href="/cart">Giỏ hàng</a></li>
                    <li><a href="/account#orders">Lịch sử đơn hàng</a></li>
                </ul>
            </div>
            
            <!-- Column 5: Customer Service -->
            <div class="footer-column">
                <h4>Dịch vụ khách hàng</h4>
                <ul>
                    <li><a href="#">Điều khoản sử dụng</a></li>
                    <li><a href="#">Chính sách bảo mật</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <script src="/js/cart-utils.js"></script>
    <script src="/js/detail.js"></script>
</body>
</html>


<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - FIAMA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body class="admin-page">
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-header-content">
            <div class="logo">
                <a href="/admin">
                    <h1>FIAMA</h1>
                    <span class="admin-badge">ADMIN</span>
                </a>
            </div>
            <div class="admin-user-info">
                <div class="user-dropdown">
                    <a href="#" class="user-link">
                        <i class="fas fa-user-shield"></i>
                        <span th:text="${userDisplayName}">Admin</span>
                    </a>
                    <div class="dropdown-menu">
                        <a href="/home">Trang chủ</a>
                        <a href="/logout">Đăng xuất</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Admin Main Content -->
    <main class="admin-main">
        <div class="admin-container">
            <!-- Sidebar -->
            <aside class="admin-sidebar">
                <div class="sidebar-header">
                    <h2><i class="fas fa-shield-alt"></i> Admin Panel</h2>
                </div>
                <nav class="sidebar-nav">
                    <a href="/admin" class="nav-item active">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="/admin/products" class="nav-item">
                        <i class="fas fa-box"></i>
                        <span>Sản phẩm</span>
                    </a>
                    <a href="/admin/orders" class="nav-item">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Đơn hàng</span>
                    </a>
                    <a href="/admin/accounts" class="nav-item">
                        <i class="fas fa-users"></i>
                        <span>Tài khoản</span>
                    </a>
                </nav>
            </aside>

            <!-- Content Area -->
            <div class="admin-content">
                <div class="content-header">
                    <h1>Dashboard</h1>
                    <p>Quản lý hệ thống</p>
                </div>

                <!-- Stats Chart -->
                <div class="stats-chart-card">
                    <div class="chart-header">
                        <h2>Thống kê tổng quan</h2>
                        <span>Hiển thị theo tổng số hiện tại</span>
                    </div>
                    <div style="position: relative; height: 300px; margin-top: 20px;">
                        <canvas id="totalsChart"></canvas>
                    </div>
                </div>

                <!-- Orders Trend -->
                <div class="stats-chart-card">
                    <div class="chart-header">
                        <h2>Đơn hàng theo tháng</h2>
                        <span>6 tháng gần nhất</span>
                    </div>
                    <canvas id="ordersTrendChart"></canvas>
                </div>
            </div>
        </div>
    </main>

    <!-- Admin Footer -->
    <footer class="admin-footer">
        <div class="admin-footer-content">
            <p>&copy; 2025 FIAMA Admin Panel. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/js/admin.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const totals = {
                products: 14,
                orders: 10,
                accounts: 6,
                revenue: 0
            };

            function createGradient(ctx, colorFrom, colorTo) {
                const gradient = ctx.createLinearGradient(0, 0, 0, ctx.canvas.height);
                gradient.addColorStop(0, colorFrom);
                gradient.addColorStop(1, colorTo);
                return gradient;
            }

            const valueLabelPlugin = {
                id: 'valueLabelPlugin',
                afterDatasetsDraw(chart) {
                    const { ctx } = chart;
                    chart.data.datasets.forEach((dataset, i) => {
                        const meta = chart.getDatasetMeta(i);
                        meta.data.forEach((bar, index) => {
                            const value = dataset.data[index];
                            ctx.save();
                            ctx.fillStyle = '#334155';
                            ctx.font = '600 12px Inter, system-ui, -apple-system, Segoe UI, Roboto';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'bottom';
                            ctx.fillText(String(value), bar.x, bar.y - 6);
                            ctx.restore();
                        });
                    });
                }
            };

            // const totalsCanvas = document.getElementById('totalsChart');
            // if (totalsCanvas) {
            //     const ctx = totalsCanvas.getContext('2d');
            //
            //     const dataValues = [totals.products, totals.orders, totals.accounts, totals.revenue];
            //     const maxValue = Math.max(...dataValues, 10); // ít nhất 10 để có chỗ
            //
            //     new Chart(ctx, {
            //         type: 'bar',
            //         data: {
            //             labels: ['Sản phẩm', 'Đơn hàng', 'Tài khoản', 'Doanh thu'],
            //             datasets: [{
            //                 data: dataValues,
            //                 backgroundColor: [
            //                     createGradient(ctx, '#6B7CFF', '#8AA2FF'),
            //                     createGradient(ctx, '#FF6B88', '#FFA1B3'),
            //                     createGradient(ctx, '#4FC3F7', '#9BE7FF'),
            //                     createGradient(ctx, '#43e97b', '#9ef7c9')
            //                 ],
            //                 borderRadius: 18,
            //                 borderSkipped: false,
            //                 maxBarThickness: 72
            //             }]
            //         },
            //         options: {
            //             maintainAspectRatio: false,
            //             layout: {
            //                 padding: { top: 30, right: 16, left: 8, bottom: 8 }
            //             },
            //             plugins: {
            //                 legend: { display: false },
            //                 tooltip: { enabled: true }
            //             },
            //             animation: { duration: 600, easing: 'easeOutQuart' },
            //             interaction: { mode: 'nearest', intersect: true },
            //             scales: {
            //                 x: {
            //                     grid: { display: false, drawBorder: false },
            //                     ticks: {
            //                         color: '#64748b',
            //                         font: { weight: 600 }
            //                     }
            //                 },
            //                 y: {
            //                     beginAtZero: true,
            //                     max: maxValue + 4, // Tự động chừa chỗ cho số cao nhất
            //                     ticks: {
            //                         precision: 0,
            //                         color: '#94a3b8',
            //                         stepSize: 2
            //                     },
            //                     grid: {
            //                         color: 'rgba(148,163,184,0.2)',
            //                         drawBorder: false
            //                     }
            //                 }
            //             }
            //         },
            //         plugins: [valueLabelPlugin]
            //     });
            // }

       // Hardcoded trend data (tạm thời)
       const trendLabels = ['Th1', 'Th2', 'Th3', 'Th4', 'Th5', 'Th6'];
       const trendValues = [2, 1, 3, 0, 1, 1];

        // Line chart - orders trend (smooth, filled)
        const trendCanvas = document.getElementById('ordersTrendChart');
        if (trendCanvas) {
            const tctx = trendCanvas.getContext('2d');
            new Chart(tctx, {
                type: 'line',
                data: {
                    labels: trendLabels,
                    datasets: [{
                        data: trendValues,
                        borderColor: '#f5576c',
                        backgroundColor: 'rgba(245, 87, 108, 0.15)',
                        tension: 0.35,
                        fill: true,
                        borderWidth: 3,
                        pointRadius: 3.5,
                        pointHoverRadius: 5,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#f5576c',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    layout: { padding: { top: 8, right: 16, left: 8, bottom: 8 } },
                    plugins: { legend: { display: false } },
                    animation: { duration: 600, easing: 'easeOutQuart' },
                    scales: {
                        x: {
                            grid: { display: false, drawBorder: false },
                            ticks: { color: '#64748b', font: { weight: 600 } }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: { precision: 0, color: '#94a3b8' },
                            grid: { color: 'rgba(148,163,184,0.2)', drawBorder: false }
                        }
                    }
                }
            });
        }
    });
    </script>
</body>
</html>

